---
# Dokument Informationen
# title: "Latex, YAML, RMarkdown"
# subtitle: "Options, packages and examples for PDF print"
# email: "info.statistik@stadtdo.de"
# author: "Dortmunder Statistik"
# documentclass: "article"
# abstract:
# subject:
# category: 
# abstract:
# lot: no # Tabellenverzeichnis
# lof: no # Abbildungsverzeichnis

fontsize: 10pt

# Layout Optionen
# margin_left: 
# margin_right:
papersize: "A4"
classoption: "twoside" # für unterschiedliche gerade und ungerade Seitenformatierungen

# Latex Optionen
header-includes:
  - \usepackage[utf8]{inputenc}
  - \usepackage{fontspec}
  - \setmainfont{Verdana}
  # Mehrspaltiges Layout
  # Abstand zwischen Spalten
  - \setlength{\columnsep}{18pt}
  # multicol - package für mehrspaltige Layouts
  - \usepackage{multicol}
  # Work around für pandoc markdown
  # https://stackoverflow.com/questions/40982836/latex-multicolumn-block-in-pandoc-markdown
  - \newcommand{\hideFromPandoc}[1]{#1} 
  - \hideFromPandoc{
      \let\Begin\begin
      \let\End\end
      }

  
  # Farbpalette    
  - \definecolor{DoStat}{RGB}{4, 72, 145} # Farbdefinitionen zur weiteren Verwendung in YAML mit package xcolor (standardmäßig geladen)
  - \definecolor{DoGray}{RGB}{33, 36, 39}
  
  # fancyhdr: Kopf- und Fußzeilen Einstellungen
  - \usepackage{fancyhdr}
  - \pagestyle{fancy}
  - \fancyhf{}
  - \fancyhead[LE]{\color{DoStat}\textbf{\nouppercase\leftmark}}
  - \fancyhead[RO]{\color{DoStat}\textbf{\nouppercase\leftmark}}
  - \fancyfoot[LE]{\color{DoStat} \thepage \hspace{0.5cm} random\textbf{text} · nr. 211 · RMarkdown, Latex und PDF · Erste Schritte}
  - \fancyfoot[RO]{\color{DoStat} random\textbf{text} · nr. 211 · RMarkdown, Latex und PDF · Erste Schritte \hspace{0.5cm} \thepage}
  - \setlength{\headheight}{12.74066pt}
  - \renewcommand{\headrulewidth}{0pt}

  
  - \usepackage{graphicx} # für includegraphics
  
  # für Tabellenüberschriften
  # https://www.namsu.de/Extra/pakete/Caption.html
  - \usepackage[justification=RaggedRight,font=small,singlelinecheck=false]{caption}
  - \usepackage{color}
  - \DeclareCaptionFont{blue}{\color{DoStat}}
  - \captionsetup{labelfont={blue,footnotesize}}
  - \captionsetup[table]{belowskip=4pt}
  - \captionsetup[figure]{belowskip=4pt}
  - \captionsetup[table]{aboveskip=4pt}
  - \captionsetup[figure]{aboveskip=4pt}
  

  - \AtBeginDocument{\let\maketitle\relax} # keine Titelseite
  - \newcommand\boldDoStat[1]{\textcolor{DoStat}{\textbf{#1}}} # Definition "boldDoStat", um gleichzeitig fett und eingefärbte Schrift zu ermöglichen

  # Tabellen Rahmen Farbe
  - \usepackage{colortbl}
  - \arrayrulecolor{DoGray}
  
  # fig.caps above table
  - \usepackage{floatrow}
  - \floatsetup[figure]{capposition=top}
  - \floatsetup[table]{capposition=top}
  
  # TODO unskalierte Grafik Beschriftung
  # - \usepackage{tikz}
  - \usepackage{tabularx}
  
  # Tabellen
  - \usepackage{makecell}
  - \renewcommand\cellgape{\Gape[4pt]}
  
  # Floats: Reduzierung von Abständen zwischen Grafiken und Text, um Verschwinden von Grafiken im 2-spaltigen Layout zu vermeiden
  # im RMarkdown Chunk müssen dann folgende Parameter gesetzt werden:
    # fig.cap= "Beschriftung", fig.pos="H",  
  # https://bookdown.org/yihui/rmarkdown-cookbook/figure-placement.html
  # https://stackoverflow.com/questions/16626462/figure-position-in-markdown-when-converting-to-pdf-with-knitr-and-pandoc
  - \usepackage{float}



  
output: 
  pdf_document:
    latex_engine: "xelatex" # erlaubt die Verwendung lokal installierter Schrifttypen
    fig_caption: true
    number_sections: false
    # toc: true # es wird stattdessen \tableofcontents benutzt
    toc_depth: 4 # wieviele Überschriftsebenen sollen im Inhaltsverzeichnis angezeigt werden


---
<!--  Umbenennung der automatisch generierten, englischen Bezeichnungen -->
<!--  full list https://stackoverflow.com/a/47237025 -->
  
\renewcommand{\figurename}{Abb.}
\renewcommand{\tablename}{Tab.}
\renewcommand{\contentsname}{Inhaltsverzeichnis}
\renewcommand{\listfigurename}{Abbildungsverzeichnis}
\renewcommand{\listtablename}{Tabellenverzeichnis}


```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE, 
  message = FALSE,
  warning = FALSE,
  out.extra = "",
  out.width = '100%', 
  dpi=300,
  dev = 'pdf'
  )

options(tinytex.verbose = TRUE)
Sys.setenv(lang = "en_US")
```

<!-- Erweitertung des Zeilenabstands für Impressum -->

\renewcommand{\arraystretch}{2}

$$\\[14cm]$$

\begin{table*}[hb]
  \begin{tabularx}{\textwidth}{r l}

    \makecell[tr]{\boldDoStat{Impressum}} & \makecell[l]{} \\
    \makecell[tr]{\textbf{Herausgeber}} &  \makecell[l]{Stadt Dortmund, 3/Dez - Stabsstelle Dortmunder Statistik, \\  44122 Dortmund, 07/2019} \\
    \makecell[tr]{\textbf{Redaktion}} &  \makecell[l]{Berthold Haermeyer (verantwortlich), Manfred Gabriel,\\ Roland Scheebaum, Georg Schulte, Iwona Szargut } \\
    \makecell[tr]{\textbf{Satz}} &  \makecell[l]{Rebecca Schluck} \\ 
    \makecell[tr]{\textbf{Layout}} &  \makecell[l]{Gerd Schmedes, Gabak Solutions,\\Grafische Konstruktionen, Dortmund} \\
    \makecell[tr]{\textbf{Kontakt}} &  \makecell[l]{InfoLine (0231) 50-22124, Telefax: (0231) 50-24777} \\
    \makecell[tr]{\textbf{eMail}} &  \makecell[l]{info.statistik@stadtdo.de} \\
    \makecell[tr]{\textbf{Internet}} &  \makecell[l]{www.statistik.dortmund.de} \\
    \makecell[tr]{} & \makecell[l]{\boldDoStat{Nachdruck, auch auszugsweise, mit Quellenangabe gestattet.}} \\
  \end{tabularx}
\end{table*}

\renewcommand{\arraystretch}{1}

\clearpage


\tableofcontents
\newpage


\listoffigures
<!-- \addcontentsline{toc}{section}{List of Figures} -->
\newpage

\listoftables
<!-- \addcontentsline{toc}{section}{List of Tables} -->

<!-- \newpage -->

```{r library, Import, results=FALSE}
# library
library(ggplot2) # plot/maps
library(kableExtra) # tables
library(wpp2015) # data für pop pyramid
library(bookdown) # package für Veröffentlichungen mit Rmarkdown, hat einige feature für Latex (floats)
library(tidyverse) # import/wrangle
library(huxtable)


source("source.R")
```


```{r data, results = FALSE}
# import und wrangle data
Bezirk <- readxl::read_excel("./data/Detailtab_Bezirk.xlsx", sheet = "Tabelle2")   %>% 
  mutate(
    across(
      contains("perc_"),
      ~ round(.,1))) 

Gesamt <- readxl::read_excel("./data/Gesamt_Staat.xlsx")

SB <- sf::st_read(dsn = "./shapes/Stadtbezirke_DO.shp") %>% 
  mutate(
    stbeznr = stringr::str_pad(stbeznr, 3, pad = "0"),
    stbeznr = case_when(
      bezeichnun == "INNENSTADT-WEST" ~"030",
      bezeichnun == "INNENSTADT-NORD" ~"040",
      bezeichnun == "INNENSTADT-OST" ~"070",
      TRUE ~ as.character(stbeznr)))



# Bevölkerungsdaten
# https://cran.r-project.org/web/packages/wpp2015/wpp2015.pdf
# Age- and sex-specific populationestimates and projections 

data("popF") # Daten weiblich
data("popM") # Daten männlich
data("UNlocations") # Schlüsselliste

# Ausländeranteil

HWBV <- readxl::read_excel("./data/HWBV.xlsx") %>% 
  mutate(Wert = round(Wert,1))


```


```{r wrangle}
# BEVÖLKERUNGSPYRAMIDE

popFemal <- popF %>% mutate(gender = "F")


# gemergte Daten für männlich und weiblich, dazu join von Kontinenten und Gruppierungen nach UN Definition
data_popFM <- popM %>% 
  mutate(gender = "M") %>% 
  bind_rows(popFemal) %>% 
  left_join(
    select(
      UNlocations,
      country_code,
      reg_code,
      reg_name,
      area_code,
      area_name),
    by = "country_code") 




# im long format
data_popFM_long <- data_popFM %>% 
  pivot_longer(
    # es werden die Spalten ent-pivotiert, die 4 Zahlen beinhalten (also bspw. 1950, 2015), also die yeares Spalten 
    cols = matches("[0-9]{4}"),
    values_to = "population",
    names_to = "year") %>% 
  mutate(
    year = as.numeric(year),
    age = factor(
      age,
      ordered = TRUE,
      levels = c(
        "0-4",
        "5-9",
        "10-14",
        "15-19",
        "20-24",
        "25-29",
        "30-34",
        "35-39",
        "40-44",
        "45-49",
        "50-54",
        "55-59",
        "60-64",
        "65-69",
        "70-74",
        "75-79",
        "80-84",
        "85-89",
        "90-94",
        "95-99",
        "100+")),
    population = as.integer(population*1000))


popPyData <- data_popFM_long %>% 
  # filtert Kontinente und Länder Gruppen heraus
  filter(!country_code >= 900) %>% 
  dplyr::group_by(
    year,
    country,
    gender) %>% 
  dplyr::mutate(
    percPop_country_gender = round(population/sum(population)*100,1)) %>% 
  ungroup() %>% 
  mutate(perc_MF = ifelse(gender == "F", percPop_country_gender*-1, percPop_country_gender)) %>% 
  filter(
    year == "2015"
    & country == "Germany")



# KARTE

Gesamt_long <- Gesamt %>% 
  slice(-1) %>% 
  select(-"Abb. 08") %>% 
  dplyr::rename(
    "Variable" = "...2",
    "deutsch_2013" = "2013...3",
    "ndeutsch_2013" = "2013...4",
    "deutsch_2018" = "2018...5",
    "ndeutsch_2018" = "2018...6") %>% 
  pivot_longer(
    cols = -c("Variable"),
    names_to = "Merkmal",
    values_to = "Anzahl") %>% 
  tidyr::separate(
    Merkmal, 
    c("Merkmal", "Jahr"),
    sep = "_") %>% 
  mutate(
    Anzahl = as.numeric(Anzahl),
    Variable = stringr::str_remove(Variable, "HWB_"),
    Variable = forcats::fct_recode(Variable,
                                   "Innenstadt-West" = "I-West",
                                   "Innenstadt-Nord" = "I-Nord",
                                   "Innenstadt-Ost" = "I-Ost"))


GebKey <- tribble(
      ~"Stadtbezirk", ~"Key",
      "Innenstadt-West", "030",
      "Innenstadt-Nord", "040",
      "Innenstadt-Ost", "070",
      "Eving", "001",
      "Scharnhorst", "002",
      "Brackel", "003",
      "Aplerbeck", "004",
      "Hörde", "005",
      "Hombruch", "006",
      "Lütgendortmund", "007",
      "Huckarde", "008",
      "Mengede", "009")


Karte <- Gesamt_long %>% 
    filter(
    Variable == "Innenstadt-West"
  | Variable ==  "Innenstadt-Nord"
  | Variable ==  "Innenstadt-Ost"
  | Variable ==  "Eving"
  | Variable ==  "Scharnhorst"
  | Variable ==  "Brackel"
  | Variable ==  "Aplerbeck"
  | Variable ==  "Hörde"
  | Variable ==  "Hombruch"
  | Variable ==  "Lütgendortmund"
  | Variable ==  "Huckarde"
  | Variable ==  "Mengede") %>% 
  filter(Jahr == "2018") %>% 
  select(
    "Stadtbezirk" = Variable,
    Merkmal,
    Anzahl) %>% 
  left_join(GebKey) %>% 
  pivot_wider(
    names_from = Merkmal,
    values_from = Anzahl) %>% 
  mutate(
    Gesamt = deutsch + ndeutsch,
    Anteil_ND = round(ndeutsch/Gesamt*100,1),
    MW_ND = round(sum(ndeutsch)/sum(Gesamt)*100,1)) %>% 
  select(
    Stadtbezirk,
    Key,
    Anteil_ND,
    MW_ND) 


Karte_breaks <- Karte %>% 
  mutate(
    # Brüche
    Intervall = as.factor(
      cut(
        Anteil_ND, 
        breaks = round(
          as.vector(cartography::getBreaks(
                Karte$Anteil_ND, 
                method = "jenks", 
                nclass = 4)),1),
        include.lowest = TRUE,
        label = c(
          "7,8 bis unter 10,7",
          "10,7 bis unter 18,1",
          "23,9",
          "52,2"))))

# join shape - Daten
SB_AnteilND <- SB %>% 
  left_join(Karte_breaks, by = c("stbeznr" = "Key"))




## Liniendiagramm
popFL <- popF %>% mutate(Gender = "F")
popML <- popM %>% mutate(Gender = "M")

popLine <- popFL %>% 
  bind_rows(popML) %>% 
  filter(
    country == "Germany"
    | country == "France") %>% 
  select(-country_code) %>% 
  pivot_longer(
    cols = -c(age, Gender, country),
    values_to = "Anzahl",
    names_to = "Jahr") %>% 
  mutate(Anzahl = Anzahl*1000) %>% 
  group_by(
    country,
    Gender,
    Jahr) %>% 
  summarize(Anzahl = sum(Anzahl))

```


```{r Map}
# Farbpalette
col_scale <- c(
      "#d6ebff",
      "#94c9ff",
      "#42a1ff",
      "#055ebd")

# Durchschnittswert für Beschriftung
mean <- SB_AnteilND$MW_ND[[1]]

Plot_map_SB_ND <- 
  ggplot(data= SB_AnteilND) +
  # Stadtbezirke
  geom_sf(
    aes(
      # Füllung, sortiert nach Anteilen, absteigend
      fill = forcats::fct_reorder(Intervall, -Anteil_ND)),
    key_glyph = draw_key_polygon,
    color = "White") +
  # Beschriftung Karte Stadtbezirksnamen
  geom_sf_text(
    aes(
      geometry = geometry,
      label = Stadtbezirk),
    size = 2) + 
  # map theme
  theme_ggplot2_map_print_A4_1C() +
  # Beschriftung
  labs(
    # Titel
    # title = "Anteil der Hauptwohnbevölkerung mit nicht-deutscher Staatsangehörigkeit",
    # # Untertitel
    # subtitle = "Stichtag 31.12.2018",
    # Fußnote
    caption = paste0("Stadtweiter Durchschnitt: ",mean),
    # Abbildungsnummer
    # tag = "Abb. 13",
    # Legendentitel
    fill = "Anteil in ") +
  # Achsenbeschriftung
  xlab("") +
  ylab("") +
  # https://ggplot2.tidyverse.org/reference/scale_steps.html
  scale_fill_manual(
    # Farben siehe oben, Anordnung umgekehrt
    values = rev(col_scale)) 
```


```{r Pyramide}

data <- popPyData
scale_variable <- c("percPop_country_gender")

scale_max <-   
  data %>% 
  select(all_of(scale_variable)) %>% 
  distinct() %>% 
  max() %>% 
  round(., 0)



Male <- ggplot(
  data = popPyData[popPyData$gender=="M",], 
  aes(
    x = percPop_country_gender,
    y = age)) +
  geom_col(fill = "cornflowerblue") +
  theme_ggplot2_popPy_print_A4_1C() +
  scale_x_continuous(
    name = "", 
    limits = c(0, scale_max), 
    breaks= scales::breaks_pretty(5), 
    expand = c(0, 1)) +   
  theme(
    # durch die umgekehrte Ausrichtung der weiblichen/männlichen Plots
    # müssen die margins separat gesetzt werden
    plot.margin = unit(c(t = 0, r = -0.5, b = 0, l = -0.5), "cm")) +
  ylab("Anteil") 
   



Female <- ggplot(
  data = popPyData[popPyData$gender=="F",], 
  aes(
    x = percPop_country_gender,
    y = age)) +
  geom_col(fill = "darkseagreen2") +
  theme_ggplot2_popPy_print_A4_1C() +
  scale_x_reverse(
    name = "", 
    # da Achse für weibliche Personen umgekehrt wird (_reverse)
    # muss auch der min und max Wert umgekehrt angegben werden
    limits = c(scale_max, 0), 
    breaks= scales::breaks_pretty(5), 
    expand = c(0, 1)) +
  theme(
    # durch die umgekehrte Ausrichtung der weiblichen/männlichen Plots
    # müssen die margins separat gesetzt werden
    plot.margin = unit(c(t = 0, r = 0, b = 0, l = -0.5), "cm"),
        axis.text.y = element_blank()) +
  ylab("Angaben in %") 

```


```{r Bar}
factorlevel <- as.character(HWBV$Variable)
scalemax <- max(HWBV$Wert)
scalemin <- min(HWBV$Wert)

HWBVBar <- HWBV %>% 
  mutate(Variable = factor(Variable, levels = rev(factorlevel))) 

HWBVBarPlot <-   ggplot(HWBVBar) + 
  geom_bar(aes(
    x = Wert, 
    y = Variable),
           stat = "identity",
           fill = "#044891",
          alpha = 0.8) +
  geom_text(
     aes(
      x = Wert, 
      y = Variable, 
      label = Wert,
      hjust = ifelse(Wert >= 0, -0.2, 1.2)),    
     size = 3,
     position = position_dodge(width = 1)) +
  geom_text(
    aes(
      x = scalemax+0.2, 
      y = Variable, 
      label = Veränderung_abs),
    size = 3) +
  # theme_ggplot2_popPy_print_A4_1C() +
  coord_cartesian(
    xlim = c(scalemin-0.2, scalemax),
            clip = 'off')  +
    theme_minimal() + 
    theme(plot.margin = unit(c(0,5,1,1), "lines")) +
    # labs(
    #   title = "Veränderung der Hauptwohnbevölkerung",
    #   subtitle = "in Stadtbezirken, 31.12.2019 bis 31.12.2020, in % und absolut",
    #   caption = "",
    #   tag = "",
    #   fill = "") +
    xlab("") +
    ylab("") 

```


```{r linechart}
popLineData <- popLine %>%
  mutate(Anzahl = round(Anzahl/1000000,1)) %>% 
  group_by(country, Jahr) %>% 
  summarise(Anzahl = sum(Anzahl)) 

popLineGraph <- ggplot(
    popLineData, 
    aes(
      x = Jahr, 
      y = Anzahl, 
      group = country, 
      color = country,
    alpha = 0.7)) +
  geom_line(lwd = 1.2) +
  scale_color_manual(
    values = c(
      "red", 
      "black")) +
  annotate(
    geom = "text",
    x = as.character(1990),
    y = 75.9,
    label = "Deutsche Einheit",
    size = 3)+
  annotate(
    geom="point", 
    x = as.character(1990), 
    y = 78.9, 
    size=5, 
    shape=21, 
    fill="transparent") +
  annotate(
    geom="Text", 
    x = as.character(2010), 
    y = 78.9, 
    size=4, 
    label = "Deutschland",
    fontface =2,
    alpha = 0.7) +
  annotate(
    geom="Text", 
    x = as.character(2010), 
    y = 59, 
    size=4, 
    label = "Frankreich",
    color = "red",
    fontface =2,
    alpha = 0.7) +
  theme_minimal() + 
  # labs(
  #     title = "Bevölkerungsentwicklung in Deutschland und Frankreich",
  #     subtitle = "1950 bis 2015",
  #     caption = "",
  #     tag = "",
  #     fill = "") +
    xlab("") +
    ylab("Anzahl in Millionen") +
  theme(legend.position = "none")
```


```{r kabledata}
# linesep function
# https://stackoverflow.com/a/65844319
linesep<-function(x,y=character()){
  if(!length(x))
    return(y)
  linesep(x[-length(x)], c(rep('',x[length(x)]-1),'\\addlinespace\\addlinespace',y))  
}

tableKableData <- Bezirk %>% 
  mutate(
    Dif_201813 = replace_na(Dif_201813, "-$^{4}$"),
    Variable = stringr::str_replace(Variable,"Sonstige\\b", "Sonstige$^{1}$"),
    Variable = stringr::str_replace(Variable,"Sonstige Mehrpersonenhaushalte", "Sonstige Mehrpersonenhaushalte^{2}$"),
    Variable = stringr::str_replace(Variable,"Bevölkerung in Haushalten insgesamt", "Bevölkerung in Haushalten insgesamt$^{3}$"))


  tableKable <- kableExtra::kbl(
    tableKableData,
    booktabs = TRUE,
    format.args = list(
      # 1000er Trennzeichen
      big.mark = ".",
      # Dezimal Trennzeichen
      decimal.mark = ','),
    longtable = FALSE,
    format = "latex",
    align = c("l", "r", "r", "r", "r", "r", "r", "r", "r" ),
    # Without escape = F, characters with a special meaning to LaTeX (like \ & % { }) will be escaped with the result, 
    # that you have the character itself in your output document. 
    linesep = linesep(c(3,8,12,15,22)),
    caption = "Stadtbezirk Innenstadt-West: Bevölkerung im Zeitvergleich 2013 bis 2018",
    # label = "",
    col.names = linebreak(
      c(
      "Stadtbezirk Innenstadt-West",
      "Anzahl",
      "in \\% der \nHWB",
      "Anzahl",
      "in \\% der \nHWB",
      "Anzahl",
      "in \\% der \nHWB",
      # aus irgendeinem Grund muss man einen Zeilenumbruch einfügen,
      # damit die Überschriften zentriert werden
      "Anzahl\n",
      "Anzahl\n"),
      align ="c"),
      escape =F) %>% 
  kable_styling(
    # font_size = 7,
    full_width = FALSE,
    latex_options = c(
      "scale_down",
      "HOLD_position")) %>% 
  column_spec(
    1:9,
    color = "DoGray") %>% 
  add_header_above(
    c(
      " " = 1,
      "2013" = 2,
      "2017" = 2,
      "2018" = 2,
      "2018 / 2013" = 1,
      "2018 / 2017" = 1),
    color = "DoGray") %>% 
  add_indent(
    c(1:4, 7:35), 
    level_of_indent = 1) %>% 
  add_indent(
    c(5:6), 
    level_of_indent = 2) %>% 
  pack_rows(
    index = c(
    "Hauptwohnbevölkerung (HWB)" = 1,
    "Bevölkerung nach Geschlecht" = 2,
    "Bevölkerung nach Migrationshintergrund" = 4,
    "Bevölkerung nach Altersgruppen" = 9,
    "Bevölkerung nach Familienstand" = 5, 
    "Bevölkerung nach Konfession" = 3,
    "Bevölkerung mit Nebenwohnsitz" = 1,
    "Bevölkerung nach Haushalten" = 6,
    "Bevölkerung nach Statistischen Bezirken" = 4),
    bold = FALSE,
    color = "#044891")  %>% 
  # Formatierung Zeile Überschrift
  row_spec(row = 0, color = "DoGray") %>% 
  # kein Strich über Kopfzeile der Tabelle
  sub("\\\\toprule", "", .) %>%
  row_spec((tableKableData %>% 
             nrow()), extra_latex_after = "\\arrayrulecolor{DoGray}") %>% 
  footnote(
    number = c(
    "\\\\textcolor{DoGray}{Hierzu zählen Lebenspartnerschaft, Lebenspartnerschaft aufgehoben, Lebenspartner verstorben und unbekannt.}",
    "\\\\textcolor{DoGray}{Sonstige Mehrpersonenhaushalte ohne Paare und ohne Kinder.}",
    "\\\\textcolor{DoGray}{Seit 2016 werden durch methodische Verbesserungen in der Haushaltegenerierung Personen in Gemeinschaftsunterkünften ausgeschlossen, weshalb die Bevölkerung in Haushalten insgesamt ab 2016 unter 100 \\\\% der HWB liegt. Die Differenz sind die Personen in Gemeinschaftsunterkünften.}",
    "\\\\textcolor{DoGray}{Durch methodische Verbesserungen (seit 2016) in der Generierung der Daten zum Migrationshintergrund und zu den Haushalten, sind die Daten für einen Zeitvergleich nicht geeignet.}"),
    threeparttable = TRUE,
    escape = FALSE,
    fixed_small_size = TRUE,)

```


\newpage

# Beispiele

## Eingefärbter Text, Bullet Points

\textcolor{DoStat}{Farbe Dostat}

- \boldDoStat{fett, und eingefärbt}
- Bullet Point Ebene 1
  - Ebene 2

\textbf{Fetter Text}

- \underline{Bullet Point Ebene 1} 
- \textit{Kursiver Text}


## 1- und 2- spaltiges Textlayout

1 spaltiger Text über 2 Spalten Layout. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.

\Begin{multicols}{2}

Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.

\columnbreak

- Bullets 2-spaltig
  - Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.

\End{multicols}

\newpage

## Mix aus Plots und Text 

\Begin{multicols}{2}

```{r  fig.pos="H", fig.cap= "Karte in 2-spaltigem Layout"}
Plot_map_SB_ND
```

Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.

```{r fig.pos="H", fig.cap= "Plot mit gaaaanz ganz ganz ganz langem Titel"} 
HWBVBarPlot
```


\columnbreak

```{r plot Pyramide, fig.pos="H", fig.cap= "Test"}

title <- cowplot::ggdraw()  + 
  cowplot::draw_label(
    "Altersgruppen der Bevölkerung Deutschlands\nStand: 31.12.2018, Angaben in %",
    x = 0,
    hjust = 0,
    size = 9
  ) +
  ggplot2::theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 7)
  )

plot <- cowplot::plot_grid(
  Female,
  Male,
  labels = c("weiblich", "männlich"))

cowplot::plot_grid(
  # title, 
  plot,
  ncol = 1
  # rel_heights values control vertical title margins
  # rel_heights = c(0.1, 1)
)
```

Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.


```{r LineGraphPlot, fig.pos="H", fig.cap= "Test"} 
popLineGraph
```

\End{multicols}

\newpage

## Plots 1 spaltig
Hier eine Ansicht in maximaler Größe
```{r MapPlotFP}
Plot_map_SB_ND
```

\vspace{5mm}

```{r pyramidPlotFP, fig.cap="Altersgruppen der Bevölkerung Deutschlands"}

title <- cowplot::ggdraw()  + 
  cowplot::draw_label(
    "Altersgruppen der Bevölkerung Deutschlands\nStand: 31.12.2018, Angaben in %",
    x = 0,
    hjust = 0
  ) +
  ggplot2::theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 7)
  )

plot <- cowplot::plot_grid(
  Female,
  Male,
  labels = c("weiblich", "männlich"))

cowplot::plot_grid(
  # title, 
  plot,
  ncol = 1
  # # rel_heights values control vertical title margins
  # rel_heights = c(0.1, 1)
)
```

\newpage

```{r LineGraphFT, fig.pos="H", fig.cap= "Line Graph full size"} 
popLineGraph
```

```{r BarPlot, fig.cap="Veränderung der Hauptwohnbevölkerung"} 
HWBVBarPlot
```


\newpage

## Tabelle Ganzseitig


```{r Plot Kable}
tableKable
```


\newpage



\begingroup
\renewcommand{\arraystretch}{0}

```{r}
tableHux <- as_hux(Bezirk)
```


```{r tableHux Plot}

tableHux  %>% 
    # cell properties
      set_all_padding(0) %>% # sets padding, for single direction `left_padding`, `right_padding`, `top_padding` and `bottom_padding`
      set_outer_padding(0) %>%  # sets the padding around the outside of the huxtable, single = left_padding etc.
      set_number_format(2:36, contains("perc"),1) %>%  # all number formats (including headers) %>% 
      set_number_format(2:36, contains("Anzahl"),0) %>%  # all number formats (including headers) %>% 
      set_number_format(2:36, contains("Dif"),0) %>%  # all number formats (including headers) %>% 
      set_bold(1, everywhere) %>% # bold setting in row 1 (headers, everywhere = every column)
      set_number_format(everywhere, everywhere, fmt_pretty(big.mark = '.', decimal.mark = ',')) %>% 
    #  table properties
      set_position("left") %>% # left alIgned on page
      set_caption("Huxtable: Stadtbezirk Innenstadt-West: Bevölkerung im Zeitvergleich 2013 bis 2018") %>% # caption of table
      set_font_size(6) %>% 
      set_width(1) %>% 
      set_tb_padding(0) %>% 
      set_col_width(c(1.2, .2,.2,.2,.2,.2,.2,.3,.3)) %>% 
      # renaming and column groups
      set_contents(1, 1:9, c("Stadtbezirk Innenstadt-West","Anzahl", "% HWB", "Anzahl", "% HWB", "Anzahl", "% HWB", "Anzahl", "Anzahl")) %>% 
      insert_row("", "2013", "", "2017", "", "2018", "", "2013/2018", "2017/2018", after = 0) %>% 
      merge_cells(1, 2:3) %>% 
      merge_cells(1, 4:5) %>% 
      merge_cells(1, 6:7) %>%
      set_align(1, everywhere, "center") %>% 
      set_tb_padding(1, everywhere, 0) %>% 
      set_bold(1, everywhere) %>% 
      set_font_size(1, 1:9, 6)   %>% 
      set_number_format(1,1:9,0)  %>%  # all number formats (including headers) 
      # define header rows and column (get repeated on page break)
      set_header_rows(1:2, TRUE) %>% 
      set_header_cols(1, TRUE) %>% 
      style_headers(bold = TRUE, text_color = "grey40") %>% 
      # set_valign(2, everywhere, "middle") %>% 
      # set_align(2, 3, "center") %>%
      # set_align(2, 5, "center") %>%
      # set_align(2, 7, "center") %>%
      set_bottom_padding(2, everywhere, 1) %>% 
      # set_left_padding(everywhere, 1, 1) %>% 
      insert_row("Haupwohnbevölkerung (HWB)", "", "", "", "", "", "", "", "", after = 2) %>% 
      insert_row("Bevölkerung nach Geschlecht", "", "", "", "", "", "", "", "", after = 4) %>% 
      insert_row("Bevölkerung nach Migrationshintergrund", "", "", "", "", "", "", "", "", after = 7) %>% 
      insert_row("Bevölkerung nach Altersgruppen", "", "", "", "", "", "", "", "", after = 12) %>% 
      insert_row("Bevölkerung nach Familienstand", "", "", "", "", "", "", "", "", after = 22) %>% 
      set_align(everywhere, 8, "right") 

      # Tabllenrahmen
      # set_tb_borders()` to set top and bottom borders;
      # set_lr_borders() `to set left and right borders;
      # set_outer_borders()` to set borders around a group of cells.
      # set_right_border(everywhere, 1, 3) %>% 
      # set_right_border_style(everywhere, 1, "double") %>% 
      # set_right_border_color(everywhere, 1, "grey")
      # set_all_borders(brdr(0.4, "solid", "white"))  %>% 
      # set_bottom_border(1, everywhere) %>%  # bottom border for row 1, every column
      # set_width(0.4) %>% # width of bottom border

```

\renewcommand{\arraystretch}{1}
\endgroup
